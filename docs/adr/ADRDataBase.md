# ADR.Нужно ли заменить базу данных на MongoDB

* Статус: Принято
* Владелец: ysmikh32@mts.ru

## Контекст
Маркетинг решил заняться позиционированием продукта “HelloConf” на рынке и хочет применять сервис конференций, как LMS систему. У данных появляются дополнительные атрибуты – план мероприятий, ссылка на материалы, текст домашнего задания и пр. Ваш тимлид решил, что так как полет фантазии и окупаемости сейчас в процессе и будет расти, то лучше перейти с реляционной БД на MongoDB. 

Так же быстро растет количество пользователей, нужно масштабироваться

## Варианты решения

### Вариант 1. Продолжаем использовать реляционную базу данных PostgreSQL
* **Плюсы**
  * Валидация данных на уровне БД
  * Быстрое чтение
  * Поддержка ACID (важно, так как в LMS системе хранятся чувствительные данные, и например, потеря данных о сданных домашках из-за возможной несогласованности на разных узлах может вызвать негативную реакцию со стороны пользователей)
  * Есть возможность работать с JSON
* **Минусы**
  * Ограниченное горизонтальное масштабирование
  * Нельзя просто так взять и поменять схему данных

### Вариант 2. Заменим PostgreSQL на MongoDB
* **Плюсы**
  * Нет предопределенной схемы базы данных
  * Нет жесткой типизации полей
  * Горизонтальное масштабирование
* **Минусы**
  * Нет валидации данных на уровне БД
  * Не соответствует ACID
  * Необходимость миграции данных

### Вариант 3. Поддержка двух разных БД для старых и новых сервисов
* **Плюсы**
  * Позволяет сохранить реляционную БД для старых сервисов
  * Позволяет использовать MongoDB для новых сервисов
* **Минусы**
  * Работа с двумя разными БД может быть сложной и требовать дополнительных усилий со стороны команды разработчиков
  * Необходимо сохранять синхронизацию данных между двумя БД

### Вариант 4. Использование PostgreSQL и MongoDB для хранения данных
* **Плюсы**
  * Использование PostgreSQL для хранения чувствительных данных обеспечивает надежность и целостность данных
  * Использование MongoDB для хранения нечувствительных данных и частей системы, которые нужно масштабировать, обеспечивает высокую гибкость и масштабируемость
  * Комбинация использования двух баз данных позволяет создать систему с высокой надежностью и гибкостью данных
* **Минусы**
  * Введение двух баз данных требует дополнительных усилий на разработку и управление системой
  * Разработчики должны иметь компетенции по работе с PostgreSQL и MongoDB, что может потребовать дополнительных ресурсов и обучения


## Решение
Принято решение использовать реляционную базу данных PostgreSQL с возможностью работы с JSON для хранения дополнительных атрибутов вместо перехода на MongoDB. Данный вариант позволит сохранить поддержку ACID и работу с SQL, а также избежать необходимости миграции данных и сложностей работы с двумя разными БД. 
## Последствия
* Необходимо настроить PostgreSQL для работы с JSON
* Необходимо повышать квалификацию команды разработчиков для работы с новыми инструментами в PostgreSQL
* Сохранится возможность горизонтального масштабирования с помощью инструментов PostgreSQL (с ограничениями: например, если в JSON-данных часто изменяются значения, то это может привести к значительному увеличению размера данных и замедлению производительности базы данных. Также следует учитывать, что репликация может повлиять на консистентность данных, и что не все операции поддерживаются при работе с JSON-данными в PostgreSQL при использовании репликации)
* Сократятся затраты команды на миграцию данных
* Сохранится работа с ACID
* Удовлетворятся требования LMS системы
